#!/bin/bash
# fix-keyring - Emergency keyring repair for when signatures fail
set -e

BOLD='\033[1m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'
log() { echo -e "${GREEN}==>${NC} ${BOLD}$1${NC}"; }
warn() { echo -e "${YELLOW}==> WARNING:${NC} $1"; }

log "Resetting pacman keyring..."

# Remove and reinitialize
sudo rm -rf /etc/pacman.d/gnupg
sudo pacman-key --init
sudo pacman-key --populate archlinux

log "Adding CachyOS key..."
sudo pacman-key --recv-keys F3B607488DB35A47 --keyserver keyserver.ubuntu.com
sudo pacman-key --lsign-key F3B607488DB35A47
sudo pacman-key --populate cachyos 2>/dev/null || true

log "Refreshing databases with signature bypass..."
sudo pacman -Syy

log "Installing fresh keyrings..."
sudo pacman -S --noconfirm archlinux-keyring cachyos-keyring

log "Keyring repair complete! Try your update again."
