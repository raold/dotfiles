#!/usr/bin/env bash
# diss-stats - Dissertation statistics (word count, pages, fonts)
# Usage: diss-stats [main.tex]

set -euo pipefail

DISS_DIR="${DISS_DIR:-$HOME/rice/nfl-analytics/analysis/dissertation/main}"
MAIN_TEX="${1:-main.tex}"
MAIN_PDF="${MAIN_TEX%.tex}.pdf"

cd "$DISS_DIR"

echo "ğŸ“Š Dissertation Statistics"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Word count from LaTeX source
echo "ğŸ“ WORD COUNT (from LaTeX source)"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
texcount -inc -total -brief "$MAIN_TEX" 2>/dev/null | grep -E "^Words|^$"
echo ""

# Detailed breakdown
echo "ğŸ“ˆ DETAILED BREAKDOWN"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
texcount -inc -brief "$MAIN_TEX" 2>/dev/null | head -30
echo ""

# PDF info if it exists
if [[ -f "$MAIN_PDF" ]]; then
    echo "ğŸ“„ PDF INFO"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    pdfinfo "$MAIN_PDF" 2>/dev/null | grep -E "^(Pages|File size|PDF version|Title|Author|CreationDate):"
    echo ""

    # File size
    PDF_SIZE=$(du -h "$MAIN_PDF" | cut -f1)
    echo "File size: $PDF_SIZE"
    echo ""

    # Font embedding check
    echo "ğŸ”¤ FONT EMBEDDING"
    echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    UNEMBEDDED=$(pdffonts "$MAIN_PDF" 2>/dev/null | tail -n +3 | grep -v "yes" | wc -l)
    if [[ "$UNEMBEDDED" -eq 0 ]]; then
        echo "âœ… All fonts are embedded (submission-ready)"
    else
        echo "âš ï¸  $UNEMBEDDED font(s) not embedded:"
        pdffonts "$MAIN_PDF" 2>/dev/null | grep -v "yes" | head -10
    fi
    echo ""

    # Total fonts
    TOTAL_FONTS=$(pdffonts "$MAIN_PDF" 2>/dev/null | tail -n +3 | wc -l)
    echo "Total fonts used: $TOTAL_FONTS"
else
    echo "âš ï¸  PDF not found. Run 'diss-watch' or 'latexmk -pdf $MAIN_TEX' first."
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
